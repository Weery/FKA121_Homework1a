\input{template_files/packages}

\input{settings}

\title{H1a: Molecular Dynamics simulation - static properties}
\author{Victor Nilsson and Simon Nilsson}
\date{\today}

\begin{document}

\input{template_files/titlepage}

\section*{Introduction}

Molecular dynamics is a simulation of the movement of atoms and molecules. What is of interest in such a simulations is e.g. the trajectories of the atoms given specific surrounding parameters such as temperature, pressure, crystal formation etc. For this homeproblem we study the dynamics of aluminium atoms in a FCC crystal lattice.\\

For the homeproblems we simulate the dynamics of the aluminium atoms by simulating their interactions. At the start of each simulation the atoms are placed on a FCC lattice with lattice parameter $\unit[4.046]{Ã…}$ \cite{al_wiki}. These atoms are initially displaced about $\unit[5]{\%}$ of the lattice parameter and their velocities are set to zero.

\section*{Problem 1}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{graphics/task1/energy.png}
    \caption{For different time-steps the energy evolves differently over time, in the figure we there are four simulations with different time-steps. The time-steps increases with $\unit[0.01]{ps}$ for each simulation and the total energy starts to increase for time-steps of $\unit[0.03]{ps}$.}
    \label{fig:timestep}
\end{figure}

For the simulations we updated the positions and velocities of the particles by applying the velocity verlet algorithm.

\begin{itemize}
\item $v \leftarrow v +\frac{1}{2}a\Delta t, \;$ update velocity from current acceleration.
\item $q \leftarrow q +v\Delta t, \;$ update displacement from current velocity.
\item $a \leftarrow a, \;$ update acceleration from the applied forces.
\item $v \leftarrow v +\frac{1}{2}a\Delta t, \;$ update velocity from new acceleration.
\end{itemize}

For this algorithm to be stable, we need to choose a time-step that conserves the total energy. With the algorithm implemented we can simulate the system and study the time evolution of the total energies. In Fig. \ref{fig:timestep} we can see the implications of different time-steps. We can see that the energy is unstable for $\Delta t = \unit[0.03]{ps}$ and stable for the previous one at $\Delta t = \unit[0.025]{ps}$. To have some safety margin we will, for the rest of the report, use a time-step of $\Delta t = \unit[0.005]{ps}$.

\section*{Problem 3}

\begin{figure}[H]
    \centering
    \captionsetup[subfigure]{justification=centering}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task3/pressure.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task3/pressure_avg.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task3/temperature.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task3/temperature_avg.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task3/traj.png}
    \end{subfigure}
    \caption{After the equilibrium, both the pressure and the temperature needs some time to stabilize after rescaling the velocities, but remains stable for longer time. The equalisation temperature was set to $\unit[500]{C^\circ}$.}
    \label{fig:equilibrium500}
\end{figure}

The third problem was about implementing routines for equilibrating the molecular dynamics system to a specified temperature, $T_{eq} = 500^\circ$ C, at pressure $P_{eq} = 1$ atm. The equilibration was implemented using scaling of the velocities and the total volume, and consquently the positions of the molecules as well. The equations used can be found in appendix D in the molecular dynamics lecture notes \cite{lecnotes}. The goal was to study the temperature and pressure after the equilibration process through constant energy and volume simulation. We also plot the trajectories of a few particles to show that the system is still in a solid state.

The three main parameters for the equilibration are the timestep (used in the velocity Verlet algorithm) $\Delta t$ and the temperature and pressure relaxation times, $\tau_T$ and $\tau_P$ respectively. The timestep used was 5 fs and the temperature relaxation time was chosen to be $\tau_T = 100 \Delta t$, i.e. choosing the $\Delta t/\tau_T$ quotient in the $\alpha_T$ calculation to be equal 0.01.

When equilibrating the pressure the isothermic compressibility, $\kappa_T$, is used when computing $\alpha_P(t)$. The isothermic compressibility for aluminium is 0.01385 GPa$^{-1}$, but $\tau_P$ is chosen in such a way that the quotient $\kappa_T \Delta t / \tau_P$.

% parameters: tau, delta t, kappa, 

In order to set the system to a certain temperature, a technique involving scaling all the velocities during a equilibrating state. Since the temperature depends on the kinetic energies which in turn depends on the velocities, the  temperature can thusly be changed by changing velocities. In figure \ref{fig:equilibrium500} we can see the temperature after setting the temperature to $\unit[500]{C^\circ}$. There are some fluctuations in the beginning due to the rescaling of the velocities.
 

\section*{Problem 4}

\begin{figure}[H]
    \centering
    \captionsetup[subfigure]{justification=centering}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task4/pressure.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task4/pressure_avg.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task4/temperature.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task4/temperature_avg.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task4/traj.png}
    \end{subfigure}
    \caption{After the equilibrium, both the pressure and the temperature needs some time to stabilize after rescaling the velocities, but remains stable for longer time. The equalisation temperature was first set to $\unit[1000]{C^\circ}$ for the smelting and then the temperature was reduced to $\unit[700]{C^\circ}$.}
    \label{fig:equilibrium500}
\end{figure}


\section*{Problem 5}

\noindent One interesting parameter of a material is the heat capacity. We can calculate it from fluctuations in either the kinetic or the potential energies,

\begin{equation}
C_v=\frac{3Nk_B}{2}\left[1-\frac{2}{3Nk_b^2T^2}\left\langle \left(\delta \epsilon_{kin}\right)^2  \right\rangle_{NVE} \right]^{-1},
\end{equation}

\begin{equation}
C_v=\frac{3Nk_B}{2}\left[1-\frac{2}{3Nk_b^2T^2}\left\langle \left(\delta \epsilon_{pot}\right)^2  \right\rangle_{NVE} \right]^{-1}.
\end{equation}

From our MD simulations we obtained the following values for $C_V$ when using the potential and kinetic energy fluctuations respectively.
\begin{table}[h!]
	\centering
	\caption{Heat capacity obtained by measuring energy fluctuations.}
	\begin{tabular}{l|cc}
		\hline \textbf{Temperature} & \textbf{500$^\circ$ C} & \textbf{700$^\circ$ C} \\ \hline
		$C_V / (\unit{eV/kg\,K})$ (kinetic) & $4.9634 \cdot 10^{-2}$ & $6.7474 \cdot 10^{-2}$ \\
		$C_V / (\unit{eV/kg\,K})$ (potential) & $4.9686 \cdot 10^{-2}$ & $6.7579 \cdot 10^{-2}$ \\ \hline
	\end{tabular}
	\label{tab:prob5}
\end{table}



\section*{Problem 6}

When instead using the relation
\begin{equation}
	C_V = \left( \frac{\partial E}{\partial T} \right)_{N,V}
\end{equation}
to compute the heat capacity, and approximate it with a difference quota, we obtain the results found in the table below.

\begin{table}[h!]
	\centering	
	\caption{Heat capacity obtained by approximating the partial energy derivative with respect to the temperature.}
	\begin{tabular}{l|cc}
		\hline \textbf{Temperature} & \textbf{500$^\circ$ C} & \textbf{700$^\circ$ C} \\ \hline
		$C_V / (\unit{eV/kg\,K})$ & $6.436 \cdot 10^{-2}$ & $8.131 \cdot 10^{-2}$ \\ \hline
	\end{tabular}
	\label{tab:prob6}
\end{table}

If we compare these results to those from the previous problem we see that they are slightly larger and the result for 700 degrees deviates by a larger margin. It's possible that a longer equilibration time would yield a more stable temperature than was obtained now and therefore a more accurate heat capacity. A longer measuring time would also increase the accuracy of the result, as well as doing more simulation and averaging the different results. A $\Delta T$ of 5$^\circ$ C was used here, but further experiementing with this parameter could yield a better result as well.

\section*{Problem 7}

The radial distribution function obtained can be found in figure~\ref{fig:radial}. Using Matlab we find that the first peak is at the distance 2.85 \r{A}, which corresponds to the shortest distance in a fcc structure with the unit cell length of 4.046 \r{A}. This is the distance between one of the corner atoms and a face centered atom close to that corner, which is expected. The other larger peaks are around 5 \r{A} and 7.17 \r{A}. These align with the two next shortest distances in an fcc structure.

\begin{figure}[H]
\centering
\captionsetup[subfigure]{justification=centering}
\begin{subfigure}[b]{0.40\textwidth}
	\centering
	\includegraphics[width=\textwidth]{graphics/task7/radial.png}
\end{subfigure}
\caption{The radial function is computed by taking the histogram over all the internal distances between the atoms then divided by the random distribution of the same density.}
\label{fig:radial}
\end{figure}

\section*{Problem 8}

Below (Fig.~\ref{fig:StaticStructure}) are two approximations of the static structure function. The leftmost figure is obtained by integrating the result from Problem 7 and the rightmost one is obtained via simulation. 

\begin{figure}[H]
    \centering
    \captionsetup[subfigure]{justification=centering}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task8/integral.png}
    \end{subfigure}
    \begin{subfigure}[b]{0.40\textwidth}
        \centering
        \includegraphics[width=\textwidth]{graphics/task8/simulated.png}
    \end{subfigure}
    \caption{The static structure function computed both from the radial distribution function in figure \ref{fig:radial} in the left and using bins in Fourier space to the right.}
    \label{fig:StaticStructure}
\end{figure}


\section*{Concluding discussion}


\vfill
\bibliography{references}
\bibliographystyle{plain} %TODO set bibstyle

\newpage
\appendix
\section{Source code}

\subsection{\texttt{Task1/MD\_main.c}}
\lstinputlisting[language=c, numbers=left]{../code/Task1/MD_main.c}

\subsection{\texttt{Task3/MD\_main.c}}
\lstinputlisting[language=c, numbers=left]{../code/Task3/MD_main.c}

\subsection{\texttt{Task4/MD\_main.c}}
\lstinputlisting[language=c, numbers=left]{../code/Task4/MD_main.c}

\subsection{\texttt{Task5/MD\_main.c}}
\lstinputlisting[language=c, numbers=left]{../code/Task5/MD_main.c}

\subsection{\texttt{Task6/MD\_main.c}}
\lstinputlisting[language=c, numbers=left]{../code/Task6/MD_main.c}

\subsection{\texttt{Task7/MD\_main.c}}
\lstinputlisting[language=c, numbers=left]{../code/Task7/MD_main.c}

\subsection{\texttt{Task8/MD\_main.c}}
\lstinputlisting[language=c, numbers=left]{../code/Task8/MD_main.c}
\lstinputlisting[language=c, numbers=left]{../code/Task8/alpotential.c}




\begin{comment}
\appendix

\section{Source Code}

Include all source code here in the appendix. Keep the code formatting clean,
use indentation, and comment your code to make it easy to understand. Also,
break lines that are too long. (Keep them under 80 characters!)

\subsection{Calculating pi using matlab: \texttt{pi.m}}
\lstinputlisting[language=matlab,numbers=left]{template_files/pi.m}

\subsection{Calculating pi using python: \texttt{pi.py}}
\lstinputlisting[language=python,numbers=left]{template_files/pi.py}

\subsection{Calculating pi using C: \texttt{pi.c}}
\lstinputlisting[language=c,numbers=left]{template_files/pi.c}

\end{comment}

\end{document}
